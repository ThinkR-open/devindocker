<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Development in Docker with {renv} • devindocker</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Bootstrap --><link href="../cosmo.css" rel="stylesheet">
<link href="../thinkr.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Development in Docker with {renv}">
<meta property="og:description" content="devindocker">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
--><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!--  Code folding --><script src="../codefolding.js"></script><link href="../codefolding.css" rel="stylesheet">
<!--
<script>
         document.write('<div class="navbar"><div class="container"><div id="code-folding-buttons" class="btn-group"><button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-_extension-text-contrast=""><span>Show/Hide all code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div></div></div>')
</script>
--><!-- google analytics
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-115082821-1');
</script>
-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">devindocker</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aa-dev-in-docker.html">Development in Docker</a>
    </li>
    <li>
      <a href="../articles/ab-dev-in-docker-with-renv.html">Development in Docker with {renv}</a>
    </li>
    <li>
      <a href="../articles/ac-docker-network.html">Include the Docker container in a network</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
          <div id="code-folding-buttons" class="btn-group">
<button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-_extension-text-contrast=""><span>Show/Hide all code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>
        </li>
        
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ab-dev-in-docker-with-renv_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="ab-dev-in-docker-with-renv_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="ab-dev-in-docker-with-renv_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Development in Docker with {renv}</h1>
            
      
      
      <div class="hidden name"><code>ab-dev-in-docker-with-renv.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">devindocker</span><span class="op">)</span></code></pre></div>
<div id="create-new-package" class="section level1">
<h1 class="hasAnchor">
<a href="#create-new-package" class="anchor"></a>Create new package</h1>
<p>You can use {devindocker} for any directory, project or even package. In the end, these are all folders on your computer.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tempdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">my_project</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html">normalizePath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tempdir</span>, <span class="st">"myproject"</span><span class="op">)</span>, mustWork <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/create_package.html">create_package</a></span><span class="op">(</span><span class="va">my_project</span>, open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; ✔ Creating '/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/RtmpYWBedz/myproject/'</span>
<span class="co">#&gt; ✔ Setting active project to '/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/RtmpYWBedz/myproject'</span>
<span class="co">#&gt; ✔ Creating 'R/'</span>
<span class="co">#&gt; ✔ Writing 'DESCRIPTION'</span>
<span class="co">#&gt; Package: myproject</span>
<span class="co">#&gt; Title: What the Package Does (One Line, Title Case)</span>
<span class="co">#&gt; Version: 0.0.0.9000</span>
<span class="co">#&gt; Authors@R (parsed):</span>
<span class="co">#&gt;     * First Last &lt;first.last@example.com&gt; [aut, cre] (YOUR-ORCID-ID)</span>
<span class="co">#&gt; Description: What the package does (one paragraph).</span>
<span class="co">#&gt; License: `use_mit_license()`, `use_gpl3_license()` or friends to pick a</span>
<span class="co">#&gt;     license</span>
<span class="co">#&gt; Encoding: UTF-8</span>
<span class="co">#&gt; LazyData: true</span>
<span class="co">#&gt; Roxygen: list(markdown = TRUE)</span>
<span class="co">#&gt; RoxygenNote: 7.0.0</span>
<span class="co">#&gt; ✔ Writing 'NAMESPACE'</span>
<span class="co">#&gt; ✔ Setting active project to '&lt;no active project&gt;'</span></code></pre></div>
<div id="use-renv-inside-docker-and-keep-installation-of-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#use-renv-inside-docker-and-keep-installation-of-packages" class="anchor"></a>Use {renv} inside Docker and keep installation of packages</h3>
<p><strong>Note that you need to launch your project with {devindocker} from outside this project. Never ever open it again locally (out of a Docker container) if you want to avoid problems with bad and not compatible local {renv} setup. It is recommended to create a project dedicated to launch {devindocker} projects.</strong></p>
<p>Launch a Docker container with your directory inside. This should be a container with Rstudio server.</p>
<p>Common and project {renv} libraries will be stored on your local computer (See details in the next section).</p>
<p>You will need to set up {renv} the first time you launch the Docker container. <strong>Follow instructions in the <code>"renv_instructions.Rmd"</code> file that is created inside your project.</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Which path to your working directory / project</span>
<span class="va">project_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tempdir</span>, <span class="st">"myproject"</span><span class="op">)</span>

<span class="co"># Which container (with Rstudio inside) ? ----</span>
<span class="co"># https://hub.docker.com/r/rocker/verse</span>
<span class="va">container</span> <span class="op">&lt;-</span> <span class="st">"rocker/geospatial:4.0.1"</span>

<span class="co"># Which port ? ----</span>
<span class="co"># _Useful if multiple Rstudio Server to launch</span>
<span class="va">port</span> <span class="op">&lt;-</span> <span class="fl">8788</span>

<span class="co"># My renv cache directory on my local computer</span>
<span class="co"># Used as persistent drive for all you Docker container with {devindocker}</span>
<span class="va">renv_cache</span> <span class="op">&lt;-</span> <span class="st">"~/renv_cache"</span>

<span class="co"># Start Docker project ----</span>
<span class="fu">devindocker</span><span class="fu">::</span><span class="fu"><a href="../reference/launch_proj_docker.html">launch_proj_docker</a></span><span class="op">(</span>
  project_path <span class="op">=</span> <span class="va">project_path</span>,
  container <span class="op">=</span> <span class="va">container</span>,
  port <span class="op">=</span> <span class="va">port</span>,
  renv_cache <span class="op">=</span> <span class="va">renv_cache</span>,
  renv_inst <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Add an Rmd with instructions inside your project</span>
  update_docker <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># Follow instructions in "renv_instructions.Rmd" to setup {renv}</span></code></pre></div>
<p>When you’re done, do not forget to stop properly the Rstudio Server: Click on Top right button to quit or <code><a href="https://rdrr.io/r/base/quit.html">q()</a></code> in the console.</p>
<p>Then, stop the container.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Stop Docker properly</span>
<span class="fu"><a href="../reference/launch_proj_docker.html">stop_proj_docker</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">project_path</span><span class="op">)</span></code></pre></div>
</div>
<div id="renv-and-its-different-storage-directories" class="section level3">
<h3 class="hasAnchor">
<a href="#renv-and-its-different-storage-directories" class="anchor"></a>{renv} and its different storage directories</h3>
<p>{renv} has two levels of storing downloaded packages. First one is for the project, second one is for your computer:</p>
<ul>
<li>
<code>".renv"</code> directory for the project is by default inside the project directory itself. This has some consequences when your project is a package during <code><a href="https://rdrr.io/r/utils/PkgUtils.html">check()</a></code> because it is copied in the temporary directory of the <code><a href="https://rdrr.io/r/utils/PkgUtils.html">check()</a></code>. A big project library may take some time and some place in your Docker container.
<ul>
<li>Using {devindocker}, these project specific packages are stored locally in your <code>project_path</code> directory by default, which is the default {renv} behaviour. Indeed, if you use global cache (with <code>renv_cache</code>), only symlinks are stored in these directory.<br>
You can change it with parameters <code>renv_out = TRUE</code> to save these in a folder called <code>".renv"</code>, in the parent directory of your project <code>renv_out_dir</code>. All project stored in the same parent directory will share this local <code>".renv"</code> library, using a specific folder inside. Inside the Docker container, the <code>".renv"</code> directory will be stored at the root of your RStudio server, in the Docker home directory. Show hidden files to se it.</li>
</ul>
</li>
<li>The directory for your computer will stored all versions of all packages downloaded, whether you continue to use them in some projects or not. This directory is classified by R versions and packages. In projects using {renv}, when you install a new package, {renv} will use this common directory to first check if you did not already downloaded the package. Then, it will link the specific desired version of the computer library to the project library wih a symlink. Inside Docker there is also a common directory. Using {devindocker}, this common library will be linked to your local computer library that you can specify using <code>renv_cache</code> paramter.</li>
</ul>
<p>Hence,</p>
<ul>
<li>Packages you install for your project in the Docker will be kept after you stop the container, using a mounted volume.</li>
<li>Global package repository common to all your {renv} project will be shared with your computer, using a mounted volume</li>
<li>RStudio preferences will be kept inside your project thanks to internal links with the Docker and a mounted volume.</li>
</ul>
</div>
<div id="activate-cache-shared-on-host" class="section level2">
<h2 class="hasAnchor">
<a href="#activate-cache-shared-on-host" class="anchor"></a>Activate cache shared on host</h2>
<ul>
<li>Store this code in your <em>project</em> <code>.Rprofile</code> file <code><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv(RENV_PATHS_CACHE = "/opt/local/renv/cache")</a></code>
</li>
<li>If cache <em>not</em> shared with host with option <code>renv_cache</code>, then de-activate cache otherwise packages will disappear at next Docker restart <code>renv::settings$use.cache(FALSE)</code>
</li>
</ul>
<div id="keep-renv_instructions-rmd-up-to-date" class="section level3">
<h3 class="hasAnchor">
<a href="#keep-renv_instructions-rmd-up-to-date" class="anchor"></a>Keep <code>"renv_instructions.Rmd"</code> up-to-date</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Which path to your working directory / project</span>
<span class="va">project_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tempdir</span>, <span class="st">"myproject"</span><span class="op">)</span>
<span class="fu"><a href="../reference/update_renv_help.html">update_renv_help</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">project_path</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="thinkr">
  <p>devindocker is a  <strong>ThinkR</strong> package. Learn more at <a href="https://rtask.thinkr.fr">rtask.thinkr.fr</a>.</p>
</div>

<div class="author">
  <p>
    Developed by Sébastien Rochette.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
